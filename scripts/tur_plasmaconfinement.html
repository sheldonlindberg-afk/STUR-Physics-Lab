<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STUR Plasma Confinement v5 – Realistic Lorentz + STUR</title>
<style>
  :root{
    --bg:#050814; --fg:#e6edf3; --muted:#9fb0c3; --accent:#ffaa00; --accent2:#66e1ff;
    --card:#0b1020; --code:#0f1630; --border:#1b2442; --link:#89b4ff;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;line-height:1.45}
  main{max-width:1000px;margin:0 auto;padding:28px}
  h1{color:var(--accent);font-size:1.9rem;margin:.2rem 0 1rem}
  h2{color:#ffcc33;margin:1.6rem 0 .6rem;font-size:1.25rem}
  p,li{color:var(--fg)}
  .note{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
  pre{background:var(--code);border:1px solid var(--border);border-radius:10px;padding:14px;overflow:auto}
  code{font-family:inherit}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:.75rem 0}
  .btn{cursor:pointer;border:1px solid var(--border);background:#0e1835;color:var(--fg);padding:8px 12px;border-radius:9px}
  .btn:hover{background:#122049}
  a{color:var(--link);text-decoration:none}
  .eq{background:var(--card);border:1px dashed var(--border);padding:12px;border-radius:10px}
  footer{margin:2rem 0 0;color:var(--muted);font-size:.9rem}
  .back{display:inline-block;margin-top:1.25rem}
</style>
</head>
<body>
<main>
  <h1>STUR Plasma Confinement v5 – Realistic Lorentz + STUR</h1>
  <div class="note">STUR Tungsten —→ Plasma Confinement • JupyterLite-safe (NumPy + Matplotlib + JSON only)</div>

  <h2>Unified Confinement Derivation (concise)</h2>
  <div class="eq">
    <p><strong>Lorentz force (2D, uniform B = B&nbsp;<sub>z</sub>&nbsp;ẑ):</strong>
      <br> \( \displaystyle \mathbf{F}_{\rm L} = q\,\mathbf{v}\times\mathbf{B}, \qquad \dot{\mathbf{v}}=\frac{q}{m}\,\mathbf{v}\times(B\,\hat{\mathbf{z}})\). </p>
    <p><strong>STUR modulation:</strong>
      <br> \( \displaystyle S(r)=\tanh\!\big(\tfrac{r}{L_0}\big)\,\big(1-e^{-r/L_0}\big) \) with
      \(S(r)\sim (r/L_0)^2\) as \(r\!\to\!0\) (regularized core) and \(S\!\to\!1\) for \(r\!\gg\!L_0\). </p>
    <p><strong>STUR–Lorentz dynamics:</strong>
      <br> \( \displaystyle \dot{\mathbf{v}}=\frac{q}{m}\,S(r)\,\mathbf{v}\times(B\,\hat{\mathbf{z}}),\quad r=\sqrt{x^2+y^2}. \)</p>
    <p><strong>Classical guiding-center scales (for comparison):</strong>
      <br> Larmor radius \( r_L=\dfrac{m v_\perp}{|q|B}\), cyclotron period \( T_c=\dfrac{2\pi m}{|q|B}\).
      With STUR, the local angular rate effectively scales as \( \Omega(r)=\dfrac{|q|B}{m}\,S(r)\), tending to the classical \( \Omega_c \) away from the core. </p>
  </div>

  <p class="note">Design matches your Gate page flow (derivation → code → copy/JupyterLite → back link). </p>

  <h2>Python Simulation (copy &amp; run in Jupyter / JupyterLite)</h2>
  <div class="toolbar">
    <button class="btn" id="copyBtn">Copy Script</button>
    <button class="btn" id="dlBtn">Download <code>stur_plasma_v5.py</code></button>
    <a class="btn" href="https://jupyterlite.github.io/demo/lab/index.html" target="_blank" rel="noopener">Open JupyterLite</a>
  </div>
  <pre><code id="pycode">#!/usr/bin/env python3
# ===============================================================
# STUR Plasma Confinement v5 – Realistic Lorentz + STUR (Lite)
# ---------------------------------------------------------------
# JupyterLite-safe: NumPy + Matplotlib + JSON only (no SciPy)
# Uses Boris pusher for robust v×B rotation with local STUR S(r).
# ===============================================================

import numpy as np, json, math
import matplotlib.pyplot as plt
plt.style.use("dark_background")

# ---------------------- constants/params ------------------------
q  = 1.602176634e-19     # C (proton)
m  = 1.67262192369e-27   # kg
Bz = 1.0                 # Tesla
R0 = 1.0e-2              # target classical Larmor radius (m)
L0 = 1.0e-3              # STUR length scale (m)

# choose v0 so classical r_L = R0
v0 = q * Bz * R0 / m
T_c = 2.0 * np.pi * m / (abs(q) * Bz)

print(f"DEBUG: R0/L0 = {R0/L0:.1f}")

def S_STUR(r, L0):
    if r <= 0.0: return 0.0
    x = r / L0
    return math.tanh(x) * (1.0 - math.exp(-x))

# -------------------------- time grid ---------------------------
n_periods = 5.0
steps_per_period = 1200       # stable + smooth
dt = T_c / steps_per_period
N  = int(n_periods * steps_per_period)

# ---------------------- state arrays (2D) -----------------------
x  = np.zeros(N);  y  = np.zeros(N)
vx = np.zeros(N);  vy = np.zeros(N)

# init: start at +x=R0, tangential +y velocity
x[0], y[0] = R0, 0.0
vx[0], vy[0] = 0.0, v0

# ------------------- Boris pusher (B-only) ----------------------
# In pure B, Boris is a rotation of velocity by angle theta = Omega*dt.
# With STUR, use local Omega = (q B/m) * S(r). This preserves norm
# stepwise and yields excellent KE stability (no E fields, no damping).

q_over_m = q / m
B = np.array([0.0, 0.0, Bz], dtype=float)

def boris_step(xi, yi, vxi, vyi, dt):
    r = math.hypot(xi, yi)
    S = S_STUR(r, L0)

    # half-accel is zero for B-only; compute rotation vector
    Omega = q_over_m * S * Bz      # signed gyrofrequency
    theta = Omega * dt             # local rotation angle

    # rotate (vx,vy) around z by theta
    c, s = math.cos(theta), math.sin(theta)
    vx_new = c * vxi - s * vyi
    vy_new = s * vxi + c * vyi

    # advance position with updated velocity (leapfrog-like)
    x_new  = xi + vx_new * dt
    y_new  = yi + vy_new * dt
    return x_new, y_new, vx_new, vy_new, S

S_t = np.zeros(N)
for i in range(N-1):
    x[i+1], y[i+1], vx[i+1], vy[i+1], S_t[i] = boris_step(x[i], y[i], vx[i], vy[i], dt)
S_t[-1] = S_STUR(math.hypot(x[-1], y[-1]), L0)

# --------------------------- diagnostics ------------------------
r   = np.hypot(x, y)
KE  = 0.5 * m * (vx*vx + vy*vy)

summary = {
    "R0_m": float(R0),
    "L0_m": float(L0),
    "B_T":  float(Bz),
    "v0_m_per_s": float(v0),
    "T_cyclotron_s": float(T_c),
    "runtime_periods": float(n_periods),
    "mean_dt_s": float(dt),
    "S_at_R0": float(S_STUR(R0, L0)),
    "mean_S_over_orbit": float(np.mean(S_t)),
    "radius_range_classical_m": [float(R0), float(R0)],   # reference
    "radius_range_STUR_m": [float(r.min()), float(r.max())],
    "KE_ratio_STUR_final_over_initial": float(KE[-1] / KE[0])
}

print("\n=== STUR Plasma Confinement v5 – SUMMARY ===")
print(json.dumps(summary, indent=4))

# ------------------------------ plots ---------------------------
# 1) Orbit
plt.figure(figsize=(6.5,6.5))
plt.plot(x, y, "-",  label="STUR-modulated (Boris)")
circ = plt.Circle((0,0), R0, fill=False, ls="--", alpha=0.4)
plt.gca().add_patch(circ)
plt.scatter([0],[0], s=25, zorder=5)
plt.axis("equal"); plt.grid(alpha=0.3)
plt.xlabel("x (m)"); plt.ylabel("y (m)")
plt.title("STUR Plasma Confinement v5 – Orbit (Bz=const)")
plt.legend(); plt.tight_layout(); plt.show()

# 2) Kinetic energy vs time
t = np.arange(N) * dt
plt.figure(figsize=(7,3))
plt.plot(t, KE, "-", label="KE (STUR, B-only)")
plt.xlabel("Time (s)"); plt.ylabel("Kinetic Energy (J)")
plt.title("Kinetic Energy (Boris; no E, no damping)")
plt.grid(alpha=0.3); plt.legend(); plt.tight_layout(); plt.show()

# 3) S(r) vs time
plt.figure(figsize=(7,3))
plt.plot(t, S_t, lw=1.4)
plt.axhline(1.0, ls="--", alpha=0.5)
plt.xlabel("Time (s)"); plt.ylabel("S(r)")
plt.title("STUR Modulation Along the Orbit")
plt.grid(alpha=0.3); plt.tight_layout(); plt.show()

print("\nRealistic Lorentz confinement with STUR regularization complete.")
print("Tag @that1sheldon  #STUR  #PlasmaPhysics  #OpenSource")
</code></pre>

  <div class="toolbar">
    <button class="btn" id="copyBtn2">Copy Script</button>
    <button class="btn" id="dlBtn2">Download <code>stur_plasma_v5.py</code></button>
    <a class="btn" href="https://jupyterlite.github.io/demo/lab/index.html" target="_blank" rel="noopener">Open JupyterLite</a>
  </div>

  <h2>Symbol key</h2>
  <div class="card">
    <ul>
      <li><strong>q, m</strong>: proton charge, mass. <strong>B</strong>: uniform axial magnetic field.</li>
      <li><strong>L<sub>0</sub></strong>: STUR length; sets core regularization.</li>
      <li><strong>S(r)</strong>: STUR scalar; →1 far from core, ~ (r/L<sub>0</sub>)² near r=0.</li>
      <li><strong>r<sub>L</sub>, T<sub>c</sub></strong>: classical Larmor radius, cyclotron period (for reference).</li>
      <li><strong>Boris pusher</strong>: energy-robust v×B rotation with local \( \Omega(r)=\frac{|q|B}{m}S(r) \).</li>
    </ul>
  </div>

  <a class="back" href="../index.html">← STUR Physics Lab</a>

  <footer>STUR Unified Resistance Physics © Sheldon Lon Lindberg</footer>
</main>

<script>
  const code = document.getElementById('pycode').innerText;

  function copyCode(){ navigator.clipboard.writeText(code); }
  function downloadCode(){
    const blob = new Blob([code], {type:'text/x-python'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'stur_plasma_v5.py';
    document.body.appendChild(a); a.click();
    URL.revokeObjectURL(url); a.remove();
  }

  document.getElementById('copyBtn').addEventListener('click', copyCode);
  document.getElementById('dlBtn').addEventListener('click', downloadCode);
  document.getElementById('copyBtn2').addEventListener('click', copyCode);
  document.getElementById('dlBtn2').addEventListener('click', downloadCode);
</script>
</body>
</html>
