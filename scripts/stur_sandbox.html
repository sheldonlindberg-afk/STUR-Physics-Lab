<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore STUR Physics ‚Äì Interactive Sandbox</title>

<style>
  body {
    background:#050814;
    color:#e6edf3;
    font-family:'Courier New', monospace;
    margin:0;
    padding:1.5rem;
  }
  h1 { text-align:center; color:#ffaa00; margin-bottom:0.75rem; }
  h2 { color:#ffcc33; }
  .panel {
    background:#0a0f1f;
    padding:1rem;
    border-radius:8px;
    max-width:900px;
    margin:1rem auto;
    box-shadow:0 0 12px #ffaa0044;
  }
  .text { max-width:900px; margin:0 auto; line-height:1.5; }
  label { display:block; margin-top:12px; }
  input[type=range] { width:100%; }
  canvas {
    width:100%;
    height:260px;
    background:#000;
    border-radius:6px;
    margin-top:1rem;
    display:block;
  }
  button {
    background:#ffaa00;
    color:#050814;
    border:none;
    border-radius:6px;
    padding:8px 14px;
    margin:4px;
    cursor:pointer;
    font-family:'Courier New', monospace;
    font-size:0.9rem;
  }
  button:hover { background:#ffcc33; }
  pre { white-space:pre-wrap; color:#00ffcc; font-size:0.9rem; }
  .links { text-align:center; margin-top:1.5rem; }
  .links a {
    display:inline-block;
    background:#0e1624;
    color:#5ad0ff;
    border:1px solid #5ad0ff;
    padding:8px 14px;
    border-radius:6px;
    text-decoration:none;
    margin:4px;
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
    font-size:0.9rem;
  }
  .energy-bars {
    display:flex;
    gap:8px;
    margin-top:0.5rem;
    font-size:0.75rem;
  }
  .energy-bar {
    flex:1;
    background:#111;
    border-radius:4px;
    padding:4px;
  }
  .energy-inner {
    height:10px;
    border-radius:3px;
  }
</style>
</head>
<body>

<h1>Explore STUR Physics ‚Äì Interactive Sandbox</h1>

<!-- ===================================================== -->
<!-- EXPANDED INTRO -->
<!-- ===================================================== -->
<p class="text">
<b>STUR Geometry Sandbox</b> is a hands-on field explorer. It lets you reshape a
STUR resistance curve and then drop a particle into the field you built.
Everything on this page is live: sliders change the curve immediately, and the
particle feels those changes as it moves.
<br><br>
The base STUR field is
<code>S(r) = tanh(r / L‚ÇÄ) ¬∑ (1 ‚àí e<sup>‚àír / L‚ÇÄ</sup>)</code>.
Here, that field is generalized and blended so you can explore how scaling,
sharpness, and slope change the geometry and the resulting motion.
<br><br>
Beginners can treat this as a visual physics toy. Advanced users can treat it
as a simple 1D potential model generated from a STUR-style geometry field.
</p>

<!-- ===================================================== -->
<!-- EDUCATIONAL CONTENT -->
<!-- ===================================================== -->

<div class="panel">
  <h2>Iteration and Experimentation</h2>
  <p class="text">
Science grows by iteration: try something, run it, see what breaks, adjust,
and try again. This sandbox supports that loop. Slide parameters, watch the
curve and motion, decide what is interesting, and change it again.
  </p>
</div>

<div class="panel">
  <h2>From Geometry to Motion</h2>
  <p class="text">
The idea behind this sandbox is simple:
  </p>
  <pre>
Geometry field  S(r)
        ‚Üì
  Blended field  S_blend(r)
        ‚Üì
 Local slope  dS_blend/dr
        ‚Üì
  Toy force  F(r) ‚âà ‚àí dS_blend/dr
        ‚Üì
     Motion of a 1D particle
  </pre>
  <p class="text">
The particle does not follow an exact physical potential here, but it responds
to the slope of the blended STUR field. This makes the relationship between
geometry and motion visible.
  </p>
</div>

<div class="panel">
  <h2>Using Code and AI Around This Sandbox</h2>
  <p class="text">
Data exported from this sandbox can be loaded into Python (for example, in
Jupyter or JupyterLite) to plot, fit, and compare to other models. AI tools
can be used to review derivations, check consistency, or suggest further
experiments, but experiments like this remain the core of learning.
  </p>
</div>

<div class="panel">
  <h2>How to Explore with the Controls</h2>
  <p class="text">
‚Ä¢ <b>L‚ÇÄ</b> changes the horizontal geometry scale.<br>
‚Ä¢ <b>A</b> rescales the vertical amplitude.<br>
‚Ä¢ <b>n</b> makes the curve softer or sharper through the tanh exponent.<br>
‚Ä¢ <b>R<sub>max</sub></b> sets the horizontal range (zoom).<br>
‚Ä¢ <b>d</b> blends between the modified field and its derivative.<br>
‚Ä¢ <b>Mass</b> changes how strongly the particle responds to a given slope.<br>
‚Ä¢ <b>Speed</b> sets how fast the simulation runs globally.<br>
‚Ä¢ <b>Kick</b> adds a burst of velocity to the particle.<br><br>
After adjusting the field and motion parameters, scroll to the sandbox at the
bottom, start the particle, and watch how the motion responds.
  </p>
</div>

<!-- ===================================================== -->
<!-- CONTROLS SECTION -->
<!-- ===================================================== -->

<div class="panel">
  <h2>Field & Motion Controls</h2>

  <label>L‚ÇÄ (geometry scale): <span id="L0_val">1.00</span></label>
  <input type="range" id="L0" min="0.2" max="3" value="1" step="0.1">

  <label>A (amplitude scale): <span id="A_val">1.00</span></label>
  <input type="range" id="A" min="0.2" max="3" value="1" step="0.1">

  <label>n (tanh exponent): <span id="n_val">1.00</span></label>
  <input type="range" id="n" min="0.5" max="3" value="1" step="0.1">

  <label>R<sub>max</sub> (horizontal range): <span id="Rmax_val">5.0</span></label>
  <input type="range" id="Rmax" min="2" max="10" value="5" step="0.5">

  <label>d (blend S vs. S‚Ä≤, 0‚Üí1): <span id="d_val">0.00</span></label>
  <input type="range" id="blend" min="0" max="1" value="0" step="0.05">

  <label>Mass (response to slope): <span id="mass_val">1.0</span></label>
  <input type="range" id="mass" min="0.2" max="5" value="1" step="0.1">

  <label>Simulation speed: <span id="speed_val">1.0√ó</span></label>
  <input type="range" id="speed" min="0.5" max="3" value="1" step="0.1">

  <div style="margin-top:0.75rem;">
    <button id="toggleAnim">‚ñ∂ Start Particle</button>
    <button id="kickBtn">‚ö° Kick Particle</button>
    <button id="resetBtn">‚ü≤ Reset</button>
    <button id="downloadBtn">‚¨á Download Data</button>
  </div>
</div>

<!-- ===================================================== -->
<!-- SANDBOX + OUTPUT (BOTTOM) -->
<!-- ===================================================== -->

<div class="panel">
  <h2>STUR Sandbox ‚Äì Curve, Particle, and Live Output</h2>
  <canvas id="plot" width="800" height="260"></canvas>

  <div class="energy-bars">
    <div class="energy-bar">
      KE
      <div id="ke_bar" class="energy-inner" style="background:#00ffcc;width:0%;"></div>
    </div>
    <div class="energy-bar">
      |Slope|
      <div id="pe_bar" class="energy-inner" style="background:#ffcc33;width:0%;"></div>
    </div>
    <div class="energy-bar">
      Total
      <div id="tot_bar" class="energy-inner" style="background:#ff66aa;width:0%;"></div>
    </div>
  </div>

  <pre id="output"></pre>
</div>

<!-- ===================================================== -->
<!-- LINKS -->
<!-- ===================================================== -->
<div class="links">
  <a href="../index.html">‚Üê STUR Physics Lab</a>
  <a href="https://x.com/that1sheldon" target="_blank">‚ú¶ X</a>
  <a href="https://www.tiktok.com/@that1sheldon" target="_blank">üéµ TikTok</a>
  <a href="https://github.com/sheldonlindberg-afk/STUR-Physics-Lab" target="_blank">‚öõ GitHub</a>
</div>

<!-- ===================================================== -->
<!-- JAVASCRIPT -->
<!-- ===================================================== -->
<script>
// ---------- Base STUR functions ----------
function S_base(r, L0) {
  const x = r / L0;
  return Math.tanh(x) * (1 - Math.exp(-x));
}

function S_prime(r, L0) {
  const x = r / L0;
  const sech2 = 1 / Math.cosh(x)**2;
  return (sech2*(1 - Math.exp(-x)) + Math.tanh(x)*Math.exp(-x)) / L0;
}

function S_mod(r, L0, A, n) {
  const x = r / L0;
  const t = Math.tanh(x);
  return A * (t**n) * (1 - Math.exp(-x));
}

function S_blend(r, L0, A, n, d) {
  const Smod = S_mod(r, L0, A, n);
  const Sprime = S_prime(r, L0);
  return (1 - d)*Smod + d*Sprime;
}

function dS_blend_dr(r, L0, A, n, d) {
  const h = 1e-3 * Math.max(1, L0);
  const r1 = Math.max(0, r - h);
  const r2 = r + h;
  const f1 = S_blend(r1, L0, A, n, d);
  const f2 = S_blend(r2, L0, A, n, d);
  return (f2 - f1) / (r2 - r1);
}

// ---------- DOM ----------
const L0_slider   = document.getElementById("L0");
const A_slider    = document.getElementById("A");
const n_slider    = document.getElementById("n");
const Rmax_slider = document.getElementById("Rmax");
const blend_slider= document.getElementById("blend");
const mass_slider = document.getElementById("mass");
const speed_slider= document.getElementById("speed");

const L0_val   = document.getElementById("L0_val");
const A_val    = document.getElementById("A_val");
const n_val    = document.getElementById("n_val");
const Rmax_val = document.getElementById("Rmax_val");
const d_val    = document.getElementById("d_val");
const mass_val = document.getElementById("mass_val");
const speed_val= document.getElementById("speed_val");

const outputEl  = document.getElementById("output");
const canvas    = document.getElementById("plot");
const ctx       = canvas.getContext("2d");

const toggleAnimBtn = document.getElementById("toggleAnim");
const kickBtn       = document.getElementById("kickBtn");
const resetBtn      = document.getElementById("resetBtn");
const downloadBtn   = document.getElementById("downloadBtn");

const ke_bar  = document.getElementById("ke_bar");
const pe_bar  = document.getElementById("pe_bar");
const tot_bar = document.getElementById("tot_bar");

// ---------- Particle & trail ----------
let particle = { r: 2.5, v: 0.0 };
let animating = false;
let trail = []; // store recent r values

// ---------- Main update ----------
function update() {
  const L0   = parseFloat(L0_slider.value);
  const A    = parseFloat(A_slider.value);
  const n    = parseFloat(n_slider.value);
  const Rmax = parseFloat(Rmax_slider.value);
  const d    = parseFloat(blend_slider.value);
  const mass = parseFloat(mass_slider.value);
  const speed= parseFloat(speed_slider.value);

  if (particle.r > Rmax) particle.r = Rmax;

  L0_val.textContent   = L0.toFixed(2);
  A_val.textContent    = A.toFixed(2);
  n_val.textContent    = n.toFixed(2);
  Rmax_val.textContent = Rmax.toFixed(1);
  d_val.textContent    = d.toFixed(2);
  mass_val.textContent = mass.toFixed(1);
  speed_val.textContent= speed.toFixed(1) + "√ó";

  drawScene(L0, A, n, Rmax, d);

  const rp    = particle.r;
  const Sraw  = S_base(rp, L0);
  const Smod  = S_mod(rp, L0, A, n);
  const Sbl   = S_blend(rp, L0, A, n, d);
  const Spr   = S_prime(rp, L0);
  const slope = dS_blend_dr(rp, L0, A, n, d);
  const F     = -slope;
  const a     = F / mass;
  const KE    = 0.5 * mass * particle.v * particle.v;
  const slopeMag = Math.abs(slope);
  const KE_rel = Math.min(1, KE*0.5);          // scaled for display
  const PE_rel = Math.min(1, slopeMag*0.5);    // treat slope magnitude as "potential"
  const tot_rel= Math.min(1, (KE_rel + PE_rel)/1.5);

  ke_bar.style.width  = (KE_rel*100).toFixed(1) + "%";
  pe_bar.style.width  = (PE_rel*100).toFixed(1) + "%";
  tot_bar.style.width = (tot_rel*100).toFixed(1) + "%";

  outputEl.textContent =
`Field parameters:
  L‚ÇÄ       = ${L0.toFixed(2)}
  A        = ${A.toFixed(2)}
  n        = ${n.toFixed(2)}
  Rmax     = ${Rmax.toFixed(2)}
  d        = ${d.toFixed(2)}
  mass     = ${mass.toFixed(2)}
  speed    = ${speed.toFixed(2)}√ó (simulation)

Particle state:
  r        = ${rp.toFixed(3)}
  v        = ${particle.v.toFixed(3)}
  slope    = ${slope.toExponential(6)}
  F ‚âà ‚àídS/dr = ${F.toExponential(6)}
  a = F/m   = ${a.toExponential(6)}

Field samples at r:
  S_base   = ${Sraw.toFixed(6)}
  S_mod    = ${Smod.toFixed(6)}
  S_blend  = ${Sbl.toFixed(6)}
  S'_base  = ${Spr.toFixed(6)}

Interpretation:
  ‚Ä¢ The yellow curve is S_blend(r).
  ‚Ä¢ All sliders reshape that curve.
  ‚Ä¢ The cyan particle slides based on slope; mass and speed control how it reacts.`;
}

// ---------- Draw curve + particle + trail ----------
function drawScene(L0, A, n, Rmax, d) {
  const W = canvas.width;
  const H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // baseline
  ctx.strokeStyle="#333";
  ctx.lineWidth=1;
  ctx.beginPath();
  ctx.moveTo(0,H/2);
  ctx.lineTo(W,H/2);
  ctx.stroke();

  // draw curve
  ctx.strokeStyle="#ffaa00";
  ctx.lineWidth=2;
  ctx.beginPath();
  for(let i=0;i<=W;i++){
    const r=(i/W)*Rmax;
    let val=S_blend(r,L0,A,n,d);
    if(val>1.2)val=1.2;
    if(val<-1.2)val=-1.2;
    const y=H/2 - val*(H*0.4);
    if(i===0)ctx.moveTo(i,y); else ctx.lineTo(i,y);
  }
  ctx.stroke();

  // draw trail
  if(trail.length>1){
    const len = trail.length;
    for(let i=1;i<len;i++){
      const r1 = trail[i-1];
      const r2 = trail[i];
      const rr1=Math.max(0,Math.min(Rmax,r1));
      const rr2=Math.max(0,Math.min(Rmax,r2));
      let v1=S_blend(rr1,L0,A,n,d);
      let v2=S_blend(rr2,L0,A,n,d);
      v1 = Math.max(-1.2,Math.min(1.2,v1));
      v2 = Math.max(-1.2,Math.min(1.2,v2));
      const x1=(rr1/Rmax)*W;
      const x2=(rr2/Rmax)*W;
      const y1=H/2 - v1*(H*0.4);
      const y2=H/2 - v2*(H*0.4);
      const alpha = i/len*0.6;
      ctx.strokeStyle="rgba(0,255,204,"+alpha.toFixed(3)+")";
      ctx.lineWidth=1.5;
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
    }
  }

  // draw particle
  const RmaxVal = Rmax;
  let rp = particle.r;
  if(rp<0)rp=0;
  if(rp>RmaxVal)rp=RmaxVal;
  let valp=S_blend(rp,L0,A,n,d);
  if(valp>1.2)valp=1.2;
  if(valp<-1.2)valp=-1.2;
  const x=(rp/RmaxVal)*W;
  const y_p=H/2 - valp*(H*0.4);

  ctx.fillStyle="#00ffcc";
  ctx.beginPath();
  ctx.arc(x,y_p,6,0,2*Math.PI);
  ctx.fill();

  // velocity arrow
  const vdraw = Math.max(-1,Math.min(1,particle.v));
  const arrowLen = 25*vdraw;
  ctx.strokeStyle="#00aaff";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(x,y_p);
  ctx.lineTo(x+arrowLen,y_p);
  ctx.stroke();
}

// ---------- Particle physics ----------
function stepParticle(L0,A,n,Rmax,d,dt,mass){
  const slope=dS_blend_dr(particle.r,L0,A,n,d);
  const F = -slope;
  const a = F / mass;
  particle.v += a * dt;
  particle.r += particle.v * dt;

  if(particle.r<0){
    particle.r=0;
    particle.v*=-0.4;
  }else if(particle.r>Rmax){
    particle.r=Rmax;
    particle.v*=-0.4;
  }

  trail.push(particle.r);
  if(trail.length>200) trail.shift();
}

function animate(ts){
  if(!animating)return;
  const L0   = parseFloat(L0_slider.value);
  const A    = parseFloat(A_slider.value);
  const n    = parseFloat(n_slider.value);
  const Rmax = parseFloat(Rmax_slider.value);
  const d    = parseFloat(blend_slider.value);
  const mass = parseFloat(mass_slider.value);
  const speed= parseFloat(speed_slider.value);

  const baseDt = 0.02;
  const dt = baseDt * speed;
  for(let i=0;i<4;i++){
    stepParticle(L0,A,n,Rmax,d,dt,mass);
  }
  update();
  requestAnimationFrame(animate);
}

// ---------- Events ----------
[L0_slider,A_slider,n_slider,Rmax_slider,blend_slider,mass_slider,speed_slider].forEach(sl=>{
  sl.addEventListener("input",update);
});

toggleAnimBtn.addEventListener("click",()=>{
  animating=!animating;
  toggleAnimBtn.textContent = animating ? "‚è∏ Pause Particle" : "‚ñ∂ Start Particle";
  if(animating) requestAnimationFrame(animate);
});

kickBtn.addEventListener("click",()=>{
  const sign = Math.random()<0.5 ? -1 : 1;
  particle.v += sign * (0.5 + Math.random()*1.0);
  update();
});

resetBtn.addEventListener("click",()=>{
  L0_slider.value   = 1;
  A_slider.value    = 1;
  n_slider.value    = 1;
  Rmax_slider.value = 5;
  blend_slider.value= 0;
  mass_slider.value = 1;
  speed_slider.value= 1;
  particle.r = 2.5;
  particle.v = 0;
  trail = [];
  animating=false;
  toggleAnimBtn.textContent="‚ñ∂ Start Particle";
  update();
});

downloadBtn.addEventListener("click",()=>{
  const L0   = parseFloat(L0_slider.value);
  const A    = parseFloat(A_slider.value);
  const n    = parseFloat(n_slider.value);
  const Rmax = parseFloat(Rmax_slider.value);
  const d    = parseFloat(blend_slider.value);
  const mass = parseFloat(mass_slider.value);

  const points=[];
  const N=200;
  for(let i=0;i<=N;i++){
    const r=(i/N)*Rmax;
    points.push({
      r,
      S_base:S_base(r,L0),
      S_mod:S_mod(r,L0,A,n),
      S_prime:S_prime(r,L0),
      S_blend:S_blend(r,L0,A,n,d)
    });
  }

  const blob=new Blob([JSON.stringify({
    L0,A,n,Rmax,d,mass,points
  },null,2)],{type:"application/json"});

  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="stur_sandbox_curve.json";
  a.click();
  URL.revokeObjectURL(url);
});

// ---------- Initial render ----------
update();
</script>

</body>
</html>
