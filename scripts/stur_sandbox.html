<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STUR Sandbox – Simple Motion Explorer</title>

<style>
  body { background:#050814; color:#e6edf3; font-family:'Courier New', monospace; margin:0; padding:1.5rem; }
  h1 { text-align:center; color:#ffaa00; margin-bottom:0.75rem; }
  h2 { color:#ffcc33; }
  .panel {
    background:#0a0f1f; padding:1rem; border-radius:8px;
    max-width:900px; margin:1rem auto; box-shadow:0 0 12px #ffaa0044;
  }
  label { display:block; margin-top:12px; }
  input[type=range] { width:100%; }
  canvas {
    width:100%; height:260px; background:#000;
    border-radius:6px; margin-top:1rem; display:block;
  }
  button {
    background:#ffaa00; color:#050814; border:none; border-radius:6px;
    padding:8px 14px; margin:4px; cursor:pointer;
  }
  button:hover { background:#ffcc33; }
  pre { white-space:pre-wrap; color:#00ffcc; font-size:0.9rem; }
</style>
</head>
<body>

<h1>STUR Geometry Sandbox</h1>

<p style="max-width:900px;margin:0 auto;line-height:1.5;">
This is a simplified STUR sandbox: change the geometry scale L₀ or zoom range R<sub>max</sub>, 
and watch the curve shift in real time.  
<br><br>
A particle slides along the curve based on its slope.  
The kick button gives the particle momentum **away from the nearest wall**, so it never gets stuck.
</p>

<!-- ===================================================== -->
<!-- CONTROLS -->
<!-- ===================================================== -->
<div class="panel">
  <h2>Controls</h2>

  <label>L₀ (geometry scale): <span id="L0_val">1.00</span></label>
  <input type="range" id="L0" min="0.2" max="3" value="1" step="0.1">

  <label>R<sub>max</sub> (horizontal range): <span id="Rmax_val">5.0</span></label>
  <input type="range" id="Rmax" min="2" max="10" value="5" step="0.5">

  <div style="margin-top:0.75rem;">
    <button id="toggleAnim">▶ Start</button>
    <button id="kickBtn">⚡ Kick</button>
    <button id="resetBtn">⟲ Reset</button>
  </div>
</div>

<!-- ===================================================== -->
<!-- SANDBOX -->
<!-- ===================================================== -->
<div class="panel">
  <h2>Curve & Particle</h2>
  <canvas id="plot" width="800" height="260"></canvas>
  <pre id="output"></pre>
</div>

<script>
// ---------- Core STUR curve ----------
function S(r, L0) {
  const x = r / L0;
  return Math.tanh(x) * (1 - Math.exp(-x));
}

function dS_dr(r, L0) {
  const h = 1e-3 * Math.max(1, L0);
  const f1 = S(Math.max(0, r-h), L0);
  const f2 = S(r+h, L0);
  return (f2 - f1) / (2*h);
}

// ---------- DOM ----------
const L0_slider   = document.getElementById("L0");
const Rmax_slider = document.getElementById("Rmax");
const L0_val      = document.getElementById("L0_val");
const Rmax_val    = document.getElementById("Rmax_val");

const canvas = document.getElementById("plot");
const ctx = canvas.getContext("2d");
const outputEl = document.getElementById("output");

const toggleBtn = document.getElementById("toggleAnim");
const kickBtn   = document.getElementById("kickBtn");
const resetBtn  = document.getElementById("resetBtn");

// ---------- Particle ----------
let particle = { r: 2.5, v: 0 };
let animating = false;
let trail = [];

// ---------- Update UI ----------
function update() {
  const L0 = parseFloat(L0_slider.value);
  const Rmax = parseFloat(Rmax_slider.value);

  L0_val.textContent = L0.toFixed(2);
  Rmax_val.textContent = Rmax.toFixed(1);

  draw(L0, Rmax);

  const slope = dS_dr(particle.r, L0);
  const F = -slope;

  outputEl.textContent =
`Parameters:
  L₀    = ${L0.toFixed(2)}
  Rmax  = ${Rmax.toFixed(2)}

Particle:
  r     = ${particle.r.toFixed(3)}
  v     = ${particle.v.toFixed(3)}
  slope = ${slope.toExponential(4)}
  F ≈ -dS/dr = ${F.toExponential(4)}`;
}

// ---------- Draw curve, trail, particle ----------
function draw(L0, Rmax) {
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // Baseline
  ctx.strokeStyle="#333";
  ctx.beginPath();
  ctx.moveTo(0,H/2); ctx.lineTo(W,H/2); ctx.stroke();

  // Curve
  ctx.strokeStyle="#ffaa00"; ctx.lineWidth=2; ctx.beginPath();
  for(let i=0;i<=W;i++){
    const r = (i/W)*Rmax;
    let val = S(r, L0);
    val = Math.max(-1.2, Math.min(1.2, val));
    const y = H/2 - val*(H*0.4);
    if(i===0) ctx.moveTo(i,y); else ctx.lineTo(i,y);
  }
  ctx.stroke();

  // Trail
  if(trail.length>1){
    for(let i=1;i<trail.length;i++){
      const r1 = trail[i-1], r2 = trail[i];
      const x1 = (r1/Rmax)*W, x2 = (r2/Rmax)*W;
      const y1 = H/2 - S(r1,L0)*(H*0.4);
      const y2 = H/2 - S(r2,L0)*(H*0.4);
      ctx.strokeStyle=`rgba(0,255,204,${i/trail.length*0.5})`;
      ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
    }
  }

  // Particle
  const xp = (particle.r/Rmax)*W;
  const yp = H/2 - S(particle.r,L0)*(H*0.4);

  ctx.fillStyle="#00ffcc";
  ctx.beginPath();
  ctx.arc(xp,yp,6,0,2*Math.PI);
  ctx.fill();
}

// ---------- Physics ----------
function step(L0, Rmax, dt=0.02) {
  const slope = dS_dr(particle.r, L0);
  const F = -slope;
  particle.v += F * dt;
  particle.r += particle.v * dt;

  // walls
  if(particle.r < 0){ particle.r=0; particle.v*=-0.5; }
  if(particle.r > Rmax){ particle.r=Rmax; particle.v*=-0.5; }

  trail.push(particle.r);
  if(trail.length>200) trail.shift();
}

function animate() {
  if(!animating) return;
  const L0   = parseFloat(L0_slider.value);
  const Rmax = parseFloat(Rmax_slider.value);

  // 3 physics steps per frame
  for(let i=0;i<3;i++) step(L0,Rmax);

  update();
  requestAnimationFrame(animate);
}

// ---------- Buttons ----------
toggleBtn.onclick = () => {
  animating = !animating;
  toggleBtn.textContent = animating ? "⏸ Pause" : "▶ Start";
  if(animating) requestAnimationFrame(animate);
};

kickBtn.onclick = () => {
  const Rmax = parseFloat(Rmax_slider.value);
  // Kick AWAY from nearest wall
  if(particle.r < Rmax/2) particle.v = 1.2 + Math.random()*0.5;
  else particle.v = -1.2 - Math.random()*0.5;
  update();
};

resetBtn.onclick = () => {
  L0_slider.value = 1;
  Rmax_slider.value = 5;
  particle.r = 2.5;
  particle.v = 0;
  trail = [];
  animating = false;
  toggleBtn.textContent="▶ Start";
  update();
};

// ---------- Init ----------
update();
</script>

</body>
</html>
