<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>STUR Neuroplasticity Lab â€“ 5D Ï‡ Synapse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* Dark STUR Lab Global */
body {
  margin:0;
  background:#05070b;
  color:#e7efff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", Segoe UI;
}
a { color:#8bf3ff; }

/* Container */
.main {
  max-width:1200px;
  margin:auto;
  padding:1.5rem;
}

/* Title */
.title {
  text-align:center;
  letter-spacing:0.03em;
  margin-bottom:1rem;
}
.subtitle {
  text-align:center;
  color:#a8b3cc;
  margin-bottom:1.5rem;
}

/* Buttons */
.btnrow {
  display:flex;
  flex-wrap:wrap;
  gap:.6rem;
  justify-content:center;
  margin-bottom:1.2rem;
}
.btn {
  background:#151c28;
  border:1px solid #3a4b63;
  padding:.45rem .9rem;
  border-radius:8px;
  color:#fff;
  text-decoration:none;
  font-size:.9rem;
  cursor:pointer;
}
.btn:hover {
  background:#1e2738;
  border-color:#8bf3ff;
}

/* Code box */
.code-box {
  background:#0a0f17;
  border:1px solid #293240;
  border-radius:8px;
  padding:.75rem 1rem;
  overflow-x:auto;
  white-space:pre;
  max-height:650px;
  font-family: "JetBrains Mono", "SF Mono", monospace;
  font-size:.82rem;
  line-height:1.25rem;
}
.code-title {
  background:#10151f;
  padding:.3rem .7rem;
  border-radius:6px 6px 0 0;
  border:1px solid #3a4b63;
  border-bottom:none;
  margin-top:1.2rem;
  display:inline-block;
}

/* Section headers */
h2 {
  margin-top:2rem;
  margin-bottom:.5rem;
  text-transform:uppercase;
  font-size:1.1rem;
  color:#33e0ff;
  text-align:center;
}
hr {
  border:0;
  border-top:1px solid #263042;
  margin:1.4rem 0;
}
footer {
  text-align:center;
  color:#7284a4;
  font-size:.75rem;
  margin-top:3rem;
}
</style>

<script>
function copyScript() {
  const t=document.getElementById("codeblock").innerText;
  navigator.clipboard.writeText(t);
  alert("Python script copied to clipboard! ðŸ§ âš¡");
}

function openSandbox() {
  window.open(
    "https://sheldonlindberg-afk.github.io/STUR-Physics-Lab/scripts/stur_sandbox.html",
    "_blank"
  );
}

function runPyodide() {
  window.open(
    "https://sheldonlindberg-afk.github.io/STUR-Physics-Lab/scripts/stur_sandbox.html",
    "_blank"
  );
}
</script>

</head>
<body>

<div class="main">

  <h1 class="title">STUR Neuroplasticity Lab</h1>
  <div class="subtitle">
    Growth Â· Coherence Â· Ï‡-Dimension Synaptic Learning Advantage
  </div>

  <div class="btnrow">
    <a class="btn" onclick="copyScript()">ðŸ“‹ Copy Script</a>
    <a class="btn" onclick="openSandbox()">ðŸš€ Open STUR Sandbox</a>
    <a class="btn" onclick="runPyodide()">âš¡ Run in JupyterLite / Pyodide</a>
    <a class="btn" href="https://sheldonlindberg-afk.github.io/STUR-Physics-Lab/">â¤º STUR Index</a>
  </div>

  <hr>

  <h2>Full Simulation Script</h2>
  <div class="code-title">Python (copy & run in STUR Sandbox)</div>

  <pre class="code-box" id="codeblock">
#!/usr/bin/env python3
# ===============================================================
# STUR Neuroplasticity Lab v5.1 â€“ 5D Ï‡ Synapse
# Axon growth â†’ Ï‡-dim Coherence â†’ HH spikes â†’ STDP advantage
# ===============================================================

import numpy as np
import matplotlib.pyplot as plt
plt.style.use("dark_background")
np.random.seed(0)

# ===============================================================
# GROWTH + COHERENCE + Ï‡-DIMENSION
# ===============================================================

mu = 1.0
k_e = 1.0
G_eff = 0.15
alpha_s = 0.6
lambda_int = 3.0
sigma_conf = 0.08
q1,q2 = -1,+1
m1,m2 = 1,1
gamma0 = 0.8
ell_B = 1.0
L0 = 1.2

r_syn = 6.0
tau_S = 0.7
eta_w = 0.7
lambda_w = 0.02
sigma_r = 0.5*r_syn
gamma_v = 1.0
noise_amp = 0.25

dt_g = 0.02
steps_g = 2200
t_g = np.arange(steps_g)*dt_g

d_neurons = 40.0
soma_A = np.array([-d_neurons/2,0])
soma_B = np.array([+d_neurons/2,0])
pos = soma_A+np.array([3.0,0])
vel = np.zeros(2)

chi = 0.0
k_chi = 1.0
gamma_chi = 0.5

def S_reg(r): return np.tanh(r/L0)*(1-np.exp(-r/L0))
def radial_bracket(r):
    r2=r*r+1e-9
    return (k_e*q1*q2-G_eff*m1*m2)/r2 + alpha_s*((1-np.exp(-r/lambda_int))/r2 + sigma_conf*r)
def radial_force(r,c_SB):
    return S_reg(r)*radial_bracket(r)+(gamma0/ell_B)*np.exp(-r/ell_B)*c_SB
def c_target(r): return np.tanh((r_syn-r)/(0.5*r_syn))

xs,ys,rs,cs,ws=[],[],[],[],[]
chi_hist=[]

c_SB=-0.2
w=0.0
for _ in range(steps_g):
    diff = pos-soma_B
    r = np.linalg.norm(diff)
    r_hat = diff/(r+1e-6)
    F_r = radial_force(r,c_SB)
    acc = -F_r*r_hat/mu - gamma_v*vel
    vel += acc*dt_g
    vel += noise_amp*np.sqrt(dt_g)*np.random.randn(2)
    pos += vel*dt_g

    chi_dot = k_chi*c_SB - gamma_chi*chi
    chi += chi_dot*dt_g

    c_SB += (c_target(r)-c_SB)*dt_g/tau_S
    c_SB=float(np.clip(c_SB,-1,1))

    proximity=np.exp(-(r-r_syn)**2/(2*sigma_r**2))
    gating=0.5*(1+c_SB)
    w+= (eta_w*proximity*gating*(1-w) - lambda_w*(1-gating)*w)*dt_g
    w=float(np.clip(w,0,1))

    xs.append(pos[0]); ys.append(pos[1])
    rs.append(r); cs.append(c_SB); ws.append(w); chi_hist.append(chi)

xs,ys,rs,cs,ws,chi_hist = map(np.array,(xs,ys,rs,cs,ws,chi_hist))
r_final,c_final,w_final = rs[-1],cs[-1],ws[-1]
lambda_X = 0.5*(1+c_final)*w_final
print("=== GROWTH RESULTS v5.1 ===")
print(r_final,c_final,round(w_final,3),"lambda_X",round(lambda_X,3))

# ===============================================================
# HODGKIN-HUXLEY + Ï‡-DIM STDP
# ===============================================================

C_m=1.0; g_Na=120.0; g_K=36.0; g_L=0.3
E_Na=50.0; E_K=-77.0; E_L=-54.4; E_syn=0.0

g0=1.0
g_syn_classic=g0*w_final
g_syn_STUR   =g0*w_final*(1+2*lambda_X)

factor_LTP_STUR=1+4*lambda_X
factor_LTD_STUR=max(0,1-3*lambda_X)

print("g_classic",round(g_syn_classic,3),"g_STUR",round(g_syn_STUR,3))

dt_hh=0.01
T_hh=120
steps_hh=int(T_hh/dt_hh)
t_hh=np.arange(steps_hh)*dt_hh

def I_ext_pre(t):
    for T0 in [10,40,70,100]:
        if T0<=t<=T0+3: return 10.0
    return 0.0

def Î±n(V): return 0.01*(V+55)/(1-np.exp(-(V+55)/10))
def Î²n(V): return 0.125*np.exp(-(V+65)/80)
def Î±m(V): return 0.1*(V+40)/(1-np.exp(-(V+40)/10))
def Î²m(V): return 4*np.exp(-(V+65)/18)
def Î±h(V): return 0.07*np.exp(-(V+65)/20)
def Î²h(V): return 1/(1+np.exp(-(V+35)/10))

V_pre=-65; n_pre=0.3177; m_pre=0.0529; h_pre=0.5961
V_pc=-65;  n_pc=0.3177; m_pc=0.0529; h_pc=0.5961
V_ps=-65;  n_ps=0.3177; m_ps=0.0529; h_ps=0.5961

s_c=0.0; s_s=0.0
tau_syn=3.0; s_jump=0.6
noise_std=0.4; spike_thr=0.0

w_c=w_final
w_s=w_final

A_plus=0.01; A_minus=0.012
tau_plus=20; tau_minus=20
decay_STDP=1e-4

V_pre_hist=np.zeros(steps_hh)
V_pc_hist=np.zeros(steps_hh)
V_ps_hist=np.zeros(steps_hh)
w_c_hist=np.zeros(steps_hh)
w_s_hist=np.zeros(steps_hh)

last_V_pre=V_pre
last_V_post=V_pc
last_pre_spike_time=None
last_post_spike_time=None

def HH_step(V,n,m,h,I):
    n+=dt_hh*(Î±n(V)*(1-n)-Î²n(V)*n)
    m+=dt_hh*(Î±m(V)*(1-m)-Î²m(V)*m)
    h+=dt_hh*(Î±h(V)*(1-h)-Î²h(V)*h)
    gNa=g_Na*(m**3)*h
    gK=g_K*(n**4)
    Iion=gNa*(V-E_Na)+gK*(V-E_K)+g_L*(V-E_L)
    V+=dt_hh*(I-Iion)/C_m
    return V,n,m,h

for k in range(steps_hh):
    t=t_hh[k]
    Iinj=I_ext_pre(t)+noise_std*np.random.randn()
    V_pre,n_pre,m_pre,h_pre=HH_step(V_pre,n_pre,m_pre,h_pre,Iinj)

    preSpike=(last_V_pre<spike_thr and V_pre>=spike_thr)
    if preSpike:
        s_c+=s_jump; s_s+=s_jump
        if last_post_spike_time!=None:
            dt=t-last_post_spike_time
            if dt>=0:
                w_c-=A_minus*np.exp(-dt/tau_minus)
                w_s-=A_minus*factor_LTD_STUR*np.exp(-dt/tau_minus)
        last_pre_spike_time=t
    last_V_pre=V_pre

    s_c+=-s_c*dt_hh/tau_syn
    s_s+=-s_s*dt_hh/tau_syn
    s_c=max(0, s_c); s_s=max(0, s_s)

    I_c=g_syn_classic*(w_c/max(w_final,1e-6))*s_c*(E_syn-V_pc)
    V_pc,n_pc,m_pc,h_pc=HH_step(V_pc,n_pc,m_pc,h_pc,I_c)

    I_s=g_syn_STUR*(w_s/max(w_final,1e-6))*s_s*(E_syn-V_ps)
    V_ps,n_ps,m_ps,h_ps=HH_step(V_ps,n_ps,m_ps,h_ps,I_s)

    postSpike=(last_V_post<spike_thr and V_pc>=spike_thr)
    if postSpike:
        if last_pre_spike_time!=None:
            dt=t-last_pre_spike_time
            if dt>=0:
                w_c+=A_plus*np.exp(-dt/tau_plus)
                w_s+=A_plus*factor_LTP_STUR*np.exp(-dt/tau_plus)
        last_post_spike_time=t
    last_V_post=V_pc

    w_c-=decay_STDP*w_c*dt_hh
    w_s-=decay_STDP*w_s*dt_hh
    w_c=float(np.clip(w_c,0,2))
    w_s=float(np.clip(w_s,0,2))

    V_pre_hist[k]=V_pre
    V_pc_hist[k] =V_pc
    V_ps_hist[k] =V_ps
    w_c_hist[k]=w_c
    w_s_hist[k]=w_s

print("Final STDP:", round(w_c_hist[-1],3), round(w_s_hist[-1],3))

# ===============================================================
# PLOT RESULTS
# ===============================================================

fig,axs=plt.subplots(2,2,figsize=(13,8))
(ax_path,ax_w),(ax_c,ax_r)=axs

ax_path.set_title("Axon Path")
sc=ax_path.scatter(xs,ys,c=t_g,s=4,cmap="plasma")
ax_path.set_aspect("equal","box")
plt.colorbar(sc,ax=ax_path,label="time (s)")

ax_w.set_title("Structural Weight w(t)")
ax_w.plot(t_g,ws)

ax_c.set_title("Coherence c(t)")
ax_c.plot(t_g,cs,color="orange")

ax_r.set_title("Distance r(t)")
ax_r.plot(t_g,rs)
ax_r.axhline(r_syn,ls="--",color="gray")

plt.tight_layout()

fig2,ax2=plt.subplots(figsize=(10,4))
chi_min=chi_hist.min()-0.5
chi_max=chi_hist.max()+0.5
chi_grid=np.linspace(chi_min,chi_max,200)
P=np.zeros((len(chi_grid),len(t_g)))
sigma_chi=max(0.01,np.std(chi_hist)*0.2)
for i,chi_v in enumerate(chi_grid):
    P[i]=np.exp(-(chi_v-chi_hist)**2/(2*sigma_chi**2))
im=ax2.imshow(P,extent=[0,t_g[-1],chi_min,chi_max],origin="lower",aspect="auto",cmap="viridis")
fig2.colorbar(im,ax=ax2,label="density")
ax2.plot(t_g,chi_hist,color="white",lw=1.4)
ax2.set_title("Ï‡-Dimension Slice")
ax2.set_ylabel("Ï‡")

fig3,ax3=plt.subplots(figsize=(11,5))
ax3.plot(t_hh,V_pre_hist,label="Pre")
ax3.plot(t_hh,V_pc_hist,label="Classic Post")
ax3.plot(t_hh,V_ps_hist,"--",label="STUR Post")
ax3.legend(); ax3.set_ylabel("mV")
ax3.set_title("Hodgkin-Huxley Spikes")

fig4,ax4=plt.subplots(figsize=(10,4))
ax4.plot(t_hh,w_c_hist,label="Classic")
ax4.plot(t_hh,w_s_hist,"--",label="STUR")
ax4.set_title("STDP Weight Evolution")
ax4.legend()

plt.show()
  </pre>

  <footer>
    STUR Neuroplasticity Lab Â· Ï‡-Dimension Synapse Advantage Â· STUR Physics Lab
  </footer>

</div>
</body>
</html>
