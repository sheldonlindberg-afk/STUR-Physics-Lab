<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚öõÔ∏è STUR Plasma Torus ‚Äî Multi-Particle 4D Manifold (Weak-Field GR)</title>
<style>
  :root { --bg:#050814; --fg:#e6edf3; --muted:#9fb0c3; --accent:#ffaa00; --link:#89b4ff;
          --card:#0b1020; --code:#0f1630; --border:#1b2442; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
    font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;line-height:1.45}
  main{max-width:1100px;margin:0 auto;padding:28px}
  h1{color:var(--accent);font-size:1.9rem;margin:.2rem 0 1rem}
  h2{color:#ffcc33;margin:1.6rem 0 .6rem;font-size:1.25rem}
  p,li{color:var(--fg)}
  .note{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
  .eq{background:var(--card);border:1px dashed var(--border);padding:12px;border-radius:10px}
  pre{background:var(--code);border:1px solid var(--border);border-radius:10px;padding:14px;overflow:auto}
  code{font-family:inherit}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:.75rem 0}
  .btn{cursor:pointer;border:1px solid var(--border);background:#0e1835;color:var(--fg);padding:8px 12px;border-radius:9px}
  .btn:hover{background:#122049}
  a{color:var(--link);text-decoration:none}
  .back{display:inline-block;margin-top:1.25rem}
  footer{margin:2rem 0 0;color:var(--muted);font-size:.9rem}
</style>
</head>
<body>
<main>
  <h1>‚öõÔ∏è STUR Plasma Torus ‚Äî Multi-Particle 4D Manifold (Weak-Field GR)</h1>
  <div class="note">Earth-lab gravity (center at ‚àíR<sub>E</sub> below), uniform B·∫ë, STUR per particle. JupyterLite-safe (NumPy + Matplotlib + JSON).</div>

  <h2>Unified STUR‚ÄìGR Derivation (lab realism)</h2>
  <div class="eq">
    <p><strong>Metric (weak field):</strong>
      \( g_{00}=-(1+2\Phi/c^2),\; g_{ij}=(1-2\Phi/c^2)\delta_{ij},\; \Phi(\mathbf r_c)=-GM/|\mathbf r_c| \) with
      \( \mathbf r_c=(x, y, z+R_E)\) (Earth center at \(z=-R_E\)).</p>
    <p><strong>EOM:</strong>
      \( \displaystyle \frac{du^\mu}{d\tau}+\Gamma^\mu_{\alpha\beta}u^\alpha u^\beta
      = \frac{q}{m}S F^\mu{}_{\nu}u^\nu,\quad \mathbf E=0,\ \mathbf B=B\hat z.\)</p>
    <p><strong>STUR:</strong>
      \( S=\tanh(r_{\rm phys}/L_0)\big(1-e^{-r_{\rm phys}/L_0}\big),\ 
         r_{\rm phys}^2\approx (1-2\Phi/c^2)(x^2+y^2+z^2).\)</p>
    <p>We split-step: gravity half-kicks ‚Üí **Boris rotation** with local \(S\) ‚Üí gravity half-kicks ‚Üí drift, and cap \(v&lt;0.99c\) for numerical safety.</p>
  </div>

  <h2>Python Simulation</h2>
  <div class="toolbar">
    <button class="btn" id="copyBtnTop">üìã Copy Script</button>
    <a class="btn" href="https://jupyterlite.github.io/demo/lab/index.html" target="_blank" rel="noopener">‚ñ∂Ô∏è Open in JupyterLite</a>
  </div>

  <pre><code id="pycode">#!/usr/bin/env python3
# ===============================================================
# STUR Plasma Torus ‚Äî Multi-Particle 4D Manifold (Weak-Field GR)
# Earth center at (0,0,-R_E) so g ‚âà 9.81 m/s^2; JupyterLite safe.
# ===============================================================
import numpy as np, math, json
import matplotlib.pyplot as plt
plt.style.use("dark_background")

# ---------- Constants & knobs ----------
c   = 2.99792458e8
G   = 6.67430e-11
M_E = 5.9722e24
R_E = 6.371e6             # Earth radius (m)
q   = 1.602176634e-19
m   = 1.67262192369e-27
Bz  = 1.5                 # Tesla
L0  = 1.0e-3              # STUR length (m)
R_major = 2.0e-2          # torus major radius (m)
a_minor = 4.0e-3          # torus minor radius (m)
Npart   = 400
beta0   = 0.12            # v/c
v0      = beta0*c
n_periods = 5.0
steps_per_period = 1000   # finer step for stability

# time step from classical cyclotron reference
T_c = 2.0*np.pi*m/(abs(q)*Bz)
dt  = T_c/steps_per_period
Nsteps = int(n_periods*steps_per_period)

rng = np.random.default_rng(42)

# ---------- Gravity (vectorized; Earth center below lab) ----------
# r_c = (x, y, z+R_E)
def phi_vec(x,y,z):
    rc2 = x*x + y*y + (z+R_E)**2
    rc  = np.sqrt(rc2)
    return -G*M_E / (rc + 1e-18)

def grad_phi_vec(x,y,z):
    rc2 = x*x + y*y + (z+R_E)**2 + 1e-18
    rc  = np.sqrt(rc2)
    fac = G*M_E / (rc2*rc)            # ‚àá(-GM/rc) = +GM r_c / rc^3
    return fac*x, fac*y, fac*(z+R_E)

# ---------- STUR scalar (vectorized, lab-space radius) ----------
def S_STUR_vec(x,y,z):
    Phi   = phi_vec(x,y,z)
    scale = 1.0 - 2.0*Phi/c**2
    r2p   = scale*(x*x + y*y + z*z)
    rp    = np.sqrt(np.clip(r2p,0.0,None))
    u     = rp / L0
    return np.tanh(u) * (1.0 - np.exp(-u))

# ---------- Torus initial conditions ----------
theta = rng.uniform(0.0, 2.0*np.pi, Npart)
psi   = rng.uniform(0.0, 2.0*np.pi, Npart)
r_minor = a_minor * (0.6 + 0.4*rng.random(Npart))
x = (R_major + r_minor*np.cos(psi)) * np.cos(theta)
y = (R_major + r_minor*np.cos(psi)) * np.sin(theta)
z =  r_minor*np.sin(psi)

# velocity tangent + small pitch
tx, ty = -np.sin(theta), np.cos(theta)
pitch  = 0.15
norm   = np.sqrt(1.0 + pitch*pitch)
vx = v0 * (tx / norm)
vy = v0 * (ty / norm)
vz = v0 * (pitch / norm)

def gamma_of(vx,vy,vz):
    b2 = (vx*vx + vy*vy + vz*vz)/c**2
    return 1.0/np.sqrt(1.0 - np.clip(b2,0.0,0.9999999))

def limit_speed(vx,vy,vz, vmax=0.99*c):
    v2 = vx*vx + vy*vy + vz*vz
    mask = v2 > vmax*vmax
    if np.any(mask):
        scale = np.sqrt((vmax*vmax)/v2[mask])
        vx[mask] *= scale; vy[mask] *= scale; vz[mask] *= scale
    return vx,vy,vz

# ---------- Boris rotation (vectorized) ----------
def boris_B_STUR(vx,vy,vz, S, dt):
    g   = gamma_of(vx,vy,vz)
    th  = (q*Bz/(g*m)) * S * dt
    cth = np.cos(th); sth = np.sin(th)
    vxn = cth*vx - sth*vy
    vyn = sth*vx + cth*vy
    return vxn, vyn, vz

# ---------- Diagnostics ----------
S_hist   = np.zeros(Nsteps)
gamma_mu = np.zeros(Nsteps)
uinv_mu  = np.zeros(Nsteps)

# ---------- Main loop ----------
for k in range(Nsteps):
    # gravity half-kick (vectorized)
    dpx, dpy, dpz = grad_phi_vec(x,y,z)  # = +GM r_c / rc^3
    gx, gy, gz    = -dpx, -dpy, -dpz     # a_g = -‚àáŒ¶  (‚âà downward z)
    vx += 0.5*dt*gx;  vy += 0.5*dt*gy;  vz += 0.5*dt*gz
    vx,vy,vz = limit_speed(vx,vy,vz)

    # Boris rotation with STUR per particle
    S_loc = S_STUR_vec(x,y,z)
    vx,vy,vz = boris_B_STUR(vx,vy,vz, S_loc, dt)
    vx,vy,vz = limit_speed(vx,vy,vz)

    # gravity second half-kick (vectorized)
    dpx, dpy, dpz = grad_phi_vec(x,y,z)
    gx, gy, gz    = -dpx, -dpy, -dpz
    vx += 0.5*dt*gx;  vy += 0.5*dt*gy;  vz += 0.5*dt*gz
    vx,vy,vz = limit_speed(vx,vy,vz)

    # drift
    x += vx*dt; y += vy*dt; z += vz*dt

    # samples
    g   = gamma_of(vx,vy,vz)
    inv = -(g*c)**2 + (g*vx)**2 + (g*vy)**2 + (g*vz)**2  # should ~ -c^2
    S_hist[k]   = float(np.mean(S_loc))
    gamma_mu[k] = float(np.mean(g))
    uinv_mu[k]  = float(np.mean(inv))

# ---------- Summary ----------
r = np.sqrt(x*x + y*y + z*z)
summary = {
  "N_particles": int(Npart),
  "B_T": float(Bz),
  "L0_m": float(L0),
  "R_major_m": float(R_major),
  "a_minor_m": float(a_minor),
  "beta0": float(beta0),
  "dt_s": float(dt),
  "steps": int(Nsteps),
  "runtime_periods_ref": float(n_periods),
  "mean_S_over_time": float(np.mean(S_hist)),
  "mean_gamma_over_time": float(np.mean(gamma_mu)),
  "uinv_flat_mean": float(np.mean(uinv_mu)),
  "uinv_flat_std": float(np.std(uinv_mu)),
  "radius_min_max_m": [float(r.min()), float(r.max())]
}
print("\\n=== STUR Plasma Torus (Multi, 4D/GR weak) ‚Äì SUMMARY ===")
print(json.dumps(summary, indent=4))

# ---------- Plots ----------
t = np.arange(Nsteps)*dt

plt.figure(figsize=(6.5,6.5))
plt.scatter(x, y, s=6, alpha=0.75)
circ = plt.Circle((0,0), R_major, fill=False, ls="--", alpha=0.5)
plt.gca().add_patch(circ)
plt.axis("equal"); plt.grid(alpha=0.3)
plt.xlabel("x (m)"); plt.ylabel("y (m)")
plt.title("STUR Plasma Torus ‚Äî XY projection (final)")
plt.tight_layout(); plt.show()

plt.figure(figsize=(7,3.8))
plt.scatter(x, z, s=6, alpha=0.75)
plt.axhline(0, ls="--", alpha=0.4)
plt.grid(alpha=0.3); plt.xlabel("x (m)"); plt.ylabel("z (m)")
plt.title("XZ projection (final)")
plt.tight_layout(); plt.show()

plt.figure(figsize=(7,3))
plt.plot(t, S_hist); plt.axhline(1.0, ls="--", alpha=0.5)
plt.xlabel("t (s)"); plt.ylabel("S")
plt.title("Mean STUR scalar vs time")
plt.grid(alpha=0.3); plt.tight_layout(); plt.show()

plt.figure(figsize=(7,3))
plt.plot(t, gamma_mu)
plt.xlabel("t (s)"); plt.ylabel("Œ≥")
plt.title("Mean Lorentz factor vs time")
plt.grid(alpha=0.3); plt.tight_layout(); plt.show()

plt.figure(figsize=(7,3))
plt.plot(t, uinv_mu); plt.axhline(-c*c, ls="--", alpha=0.6)
plt.xlabel("t (s)"); plt.ylabel("‚ü®u¬∑u‚ü© (m¬≤/s¬≤)")
plt.title("Invariant check (flat proxy)")
plt.grid(alpha=0.3); plt.tight_layout(); plt.show()

print("\\nWorldlines integrated: split Boris + STUR per particle + weak-field gravity (Earth center at -R_E).")
print("Tag @that1sheldon  #STUR  #PlasmaPhysics  #Relativity  #OpenSource")
</code></pre>

  <div class="toolbar">
    <button class="btn" id="copyBtnBottom">üìã Copy Script</button>
    <a class="btn" href="https://jupyterlite.github.io/demo/lab/index.html" target="_blank" rel="noopener">‚ñ∂Ô∏è Open in JupyterLite</a>
  </div>

  <a class="back" href="../index.html">‚Üê STUR Physics Lab</a>
  <footer>STUR Unified Resistance Physics ¬© Sheldon Lon Lindberg</footer>
</main>

<script>
async function copySTUR(){
  const text = document.getElementById("pycode").innerText;
  try{
    await navigator.clipboard.writeText(text);
    for(const id of ["copyBtnTop","copyBtnBottom"]){
      const btn=document.getElementById(id); if(!btn) continue;
      const old=btn.textContent; btn.textContent="‚úÖ Copied!";
      setTimeout(()=>btn.textContent=old,1400);
    }
  }catch(e){ alert("Copy failed ‚Äî select the code and copy manually."); }
}
for(const id of ["copyBtnTop","copyBtnBottom"])
  document.getElementById(id).addEventListener("click", copySTUR);
</script>
</body>
</html>
